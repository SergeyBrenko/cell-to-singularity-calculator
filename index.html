<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wait Time Calculator</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <style>
      :root {
        --bg: #0b1220;
        --panel: rgba(255, 255, 255, 0.06);
        --panel2: rgba(255, 255, 255, 0.08);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.7);
        --muted2: rgba(255, 255, 255, 0.55);
        --border: rgba(255, 255, 255, 0.12);
        --accent: #78a6ff;
        --danger: #ff6a7a;
        --shadow: rgba(0, 0, 0, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(1200px 600px at 20% 10%, rgba(120, 166, 255, 0.25), transparent 55%),
          radial-gradient(1000px 600px at 80% 30%, rgba(116, 255, 208, 0.12), transparent 60%),
          var(--bg);
      }

      .wrap {
        max-width: 710px;
        padding: 0 14px;
      }

      .header {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        padding: 12px 0;
      }

      .title {
        font-size: 16px;
        letter-spacing: 0.2px;
        margin: 0;
      }

      .card {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.05));
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 10px 28px var(--shadow);
        overflow: hidden;
      }

      .tabs {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-bottom: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.1);
        overflow-x: auto;
      }

      .tab {
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: rgba(255, 255, 255, 0.78);
        cursor: pointer;
        font-size: 13px;
        padding: 6px 12px;
        border-radius: 999px;
        line-height: 1;
        white-space: nowrap;
        transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      }

      .tab:hover {
        background: var(--panel2);
        color: var(--text);
      }

      .tab.active {
        color: var(--text);
        border-color: rgba(120, 166, 255, 0.75);
        background: rgba(120, 166, 255, 0.18);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.18);
        transform: translateY(-1px);
      }

      .content {
        padding: 6px 12px;
        display: grid;
        gap: 8px;
      }

      .row {
        display: grid;
        grid-template-columns: 80px 1fr;
        gap: 8px;
        align-items: center;
      }

      @media (max-width: 900px) {
        .row {
          grid-template-columns: 80px 1fr;
        }

        .label {
          font-size: 12px;
        }

        .content {
          padding: 6px 10px;
          gap: 7px;
        }

        .tabs {
          padding: 6px 10px;
        }

        .tab {
          font-size: 12px;
          padding: 6px 10px;
        }

        .sci {
          flex-wrap: nowrap;
          white-space: nowrap;
          overflow-x: auto;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
        }

        .sci::-webkit-scrollbar {
          height: 0px;
        }
      }

      @media (max-width: 520px) {
        .content {
          padding: 6px 8px;
          gap: 7px;
        }

        .row {
          grid-template-columns: 96px 1fr;
          gap: 5px;
          align-items: center;
        }

        .label {
          font-size: 12px;
        }

        .sci {
          flex-wrap: nowrap;
          gap: 5px;
          white-space: nowrap;
          overflow-x: auto;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
        }

        .sci::-webkit-scrollbar {
          height: 0;
        }

        .sci::-webkit-scrollbar {
          height: 0;
        }

        .stepGroup {
          padding: 0;
          gap: 4px;
          border-radius: 10px;
        }

        .stepBtn {
          width: 26px;
          height: 26px;
          border-radius: 8px;
          font-size: 14px;
        }

        .inp {
          width: 78px;
          flex: 0 0 78px;
          padding: 6px 8px;
          font-size: 13px;
        }

        .inpExp {
          width: 62px;
          flex: 0 0 62px;
        }

        .times {
          font-size: 12px;
        }

        .mult {
          justify-content: space-between;
          width: 100%;
        }
      }

      @media (max-width: 420px) {
        .title {
          font-size: 15px;
        }

        .label {
          font-size: 12px;
        }

        .metaRow {
          grid-template-columns: 1fr;
          gap: 8px;
        }

        .mult {
          justify-content: space-between;
        }

        .tab {
          font-size: 12px;
          padding: 6px 10px;
        }
      }

      .label {
        color: var(--muted);
        font-size: 12px;
      }

      .sci {
        display: flex;
        align-items: center;
        gap: 4px;
        min-width: 0;
        white-space: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
      }

      .expRow {
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: max-content;
      }

      .sci::-webkit-scrollbar {
        height: 6px;
      }

      .sci::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.18);
        border-radius: 999px;
      }

      .times {
        color: var(--muted2);
        font-size: 13px;
        white-space: nowrap;
        user-select: none;
        flex: 0 0 auto;
      }

      .control {
        display: flex;
        align-items: center;
        gap: 6px;
        flex-wrap: nowrap;
        min-width: max-content;
      }

      .stepGroup {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 0;
        border: 0;
        border-radius: 0;
        background: transparent;
        flex: 0 0 auto;
      }

      .stepBtn {
        width: 30px;
        height: 25px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.28);
        background: rgba(0, 0, 0, 0.28);
        font-size: 16px;
        line-height: 1;
        box-shadow:
          0 1px 0 rgba(255, 255, 255, 0.08) inset,
          0 0 0 1px rgba(0, 0, 0, 0.25);
      }

      .btn {
        background: transparent;
        color: var(--text);
        cursor: pointer;
        font-size: 16px;
        display: grid;
        place-items: center;
      }

      .btn:hover {
        background: var(--panel2);
      }

      .stepBtn:hover {
        background: rgba(255, 255, 255, 0.10);
        border-color: rgba(255, 255, 255, 0.38);
      }

      .stepBtn:active {
        transform: translateY(1px);
      }

      .inp {
        width: 88px;
        flex: 0 0 83px;
        border: 1px solid var(--border);
        outline: none;
        padding: 6px 10px;
        background: var(--panel);
        color: var(--text);
        font-size: 14px;
        min-width: 0;
        font-variant-numeric: tabular-nums;
        border-radius: 10px;
      }

      .inpExp {
        width: 68px;
        flex: 0 0 63px;
      }

      .inp::placeholder {
        color: rgba(255, 255, 255, 0.35);
      }

      .metaRow {
        display: grid;
        grid-template-columns: 1fr;
        align-items: start;
        gap: 12px;
      }

      .mult {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--muted);
        font-size: 12px;
        justify-content: flex-start;
      }

      .multLabel {
        color: var(--muted2);
      }

      .multValue {
        min-width: 32px;
        text-align: center;
        color: var(--text);
        font-variant-numeric: tabular-nums;
      }

      .mult .btn {
        height: 22px;
        padding: 0 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.14);
        font-size: 12px;
      }

      .mult .btn:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .check {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--muted);
        font-size: 13px;
        user-select: none;
        line-height: 1.1;
      }

      .check input {
        width: 16px;
        height: 16px;
        accent-color: var(--accent);
      }

      .result {
        border-top: 1px solid var(--border);
        padding: 6px 10px;
        display: grid;
        background: rgba(0, 0, 0, 0.1);
      }

      .status {
        font-size: 12px;
        color: var(--muted2);
        margin: 0;
      }

      .status:empty {
        display: none;
      }

      .value {
        font-size: 18px;
        font-variant-numeric: tabular-nums;
        margin: 0;
      }

      .valueSmall {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        font-variant-numeric: tabular-nums;
      }

      .error {
        color: var(--danger);
      }

      .hint {
        color: var(--muted2);
        font-size: 12px;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">
        <h1 class="title">Wait Time Calculator</h1>
      </div>

      <div class="card">
        <div class="tabs" role="tablist" aria-label="Tabs">
          <button class="tab" type="button" data-tab="main">Main</button>
          <button class="tab" type="button" data-tab="valley">Valley</button>
          <button class="tab" type="button" data-tab="space">Space</button>
          <button class="tab" type="button" data-tab="event">Event</button>
        </div>
        <div class="content">
          <div class="row">
            <div class="label">+ / sec</div>
            <div class="sci">
              <div class="control">
                <input
                  id="rateMantissa"
                  class="inp"
                  type="number"
                  min="0"
                  step="0.1"
                  value="1"
                  inputmode="decimal"
                />
              </div>
              <div class="expRow">
                <div class="times">× 10^</div>
                <div class="control">
                  <div class="stepGroup" aria-label="Rate exponent decrease">
                    <button class="btn stepBtn" type="button" data-step="rateExponent" data-delta="-10">-</button>
                    <button class="btn stepBtn" type="button" data-step="rateExponent" data-delta="-1">-</button>
                  </div>
                  <input
                    id="rateExponent"
                    class="inp inpExp"
                    type="text"
                    inputmode="numeric"
                    value="0"
                    aria-label="Rate exponent"
                  />
                  <div class="stepGroup" aria-label="Rate exponent increase">
                    <button class="btn stepBtn" type="button" data-step="rateExponent" data-delta="1">+</button>
                    <button class="btn stepBtn" type="button" data-step="rateExponent" data-delta="10">+</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="label">Target</div>
            <div class="sci">
              <div class="control">
                <input
                  id="targetMantissa"
                  class="inp"
                  type="number"
                  min="0"
                  step="0.1"
                  value="7.2"
                  inputmode="decimal"
                />
              </div>
              <div class="expRow">
                <div class="times">× 10^</div>
                <div class="control">
                  <div class="stepGroup" aria-label="Target exponent decrease">
                    <button class="btn stepBtn" type="button" data-step="targetExponent" data-delta="-10">-</button>
                    <button class="btn stepBtn" type="button" data-step="targetExponent" data-delta="-1">-</button>
                  </div>
                  <input
                    id="targetExponent"
                    class="inp inpExp"
                    type="text"
                    inputmode="numeric"
                    value="25"
                    aria-label="Target exponent"
                  />
                  <div class="stepGroup" aria-label="Target exponent increase">
                    <button class="btn stepBtn" type="button" data-step="targetExponent" data-delta="1">+</button>
                    <button class="btn stepBtn" type="button" data-step="targetExponent" data-delta="10">+</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="metaRow">
            <div class="mult" aria-label="Devide time by">
              <span class="multLabel">Devide time by</span>
              <button class="btn" type="button" id="rateMulDown">÷2</button>
              <span id="rateMulValue" class="multValue">×1</span>
              <button class="btn" type="button" id="rateMulUp">×2</button>
            </div>
          </div>
        </div>

        <div class="result">
          <div class="resultTitle">
            <p id="status" class="status">Ready</p>
          </div>
          <p id="timeHuman" class="value">—</p>
        </div>
      </div>
    </div>

    <script>
      const MAX_ALIGN_DIGITS = 24n;
      const STORAGE_KEY = "waitTimeCalculator.v2";
      const TAB_KEY = `${STORAGE_KEY}.activeTab`;
      const TABS = ["main", "valley", "space", "event"];
      const STATE_IDS = [
        "targetMantissa",
        "targetExponent",
        "rateMantissa",
        "rateExponent",
      ];

      let activeTab = "main";
      let rateMultiplier = 1;

      function syncRateMultiplierUI() {
        const el = document.getElementById("rateMulValue");
        if (el) el.textContent = `×${rateMultiplier}`;
      }

      function getRateMultiplier() {
        return rateMultiplier;
      }

      function getStoredActiveTab() {
        const t = localStorage.getItem(TAB_KEY);
        return TABS.includes(t) ? t : "main";
      }

      function updateTabsUI() {
        const buttons = document.querySelectorAll(".tab[data-tab]");
        for (const btn of buttons) {
          const tab = btn.getAttribute("data-tab");
          btn.classList.toggle("active", tab === activeTab);
        }
      }

      function setActiveTab(nextTab) {
        activeTab = TABS.includes(nextTab) ? nextTab : "main";
        localStorage.setItem(TAB_KEY, activeTab);
        updateTabsUI();
      }

      function isFiniteNumber(x) {
        return typeof x === "number" && Number.isFinite(x);
      }

      function pow10(n) {
        return 10 ** n;
      }

      function normalizeSci(s) {
        let m = s.m;
        let e = s.e;

        if (!isFiniteNumber(m) || m === 0) {
          return { m: 0, e: 0n };
        }

        const sign = m < 0 ? -1 : 1;
        m = Math.abs(m);

        if (m < 1) {
          while (m !== 0 && m < 1) {
            m *= 10;
            e -= 1n;
          }
        } else if (m >= 10) {
          while (m >= 10) {
            m /= 10;
            e += 1n;
          }
        }

        return { m: sign * m, e };
      }

      function parseBigIntStrict(str) {
        const s = String(str).trim();
        if (s === "") return null;
        if (!/^[+-]?\d+$/.test(s)) return null;
        try {
          return BigInt(s);
        } catch {
          return null;
        }
      }

      function loadState(tab) {
        let parsed = null;
        try {
          const raw = localStorage.getItem(`${STORAGE_KEY}.${tab}`);
          if (raw) parsed = JSON.parse(raw);
        } catch {
          parsed = null;
        }

        for (const id of STATE_IDS) {
          const el = document.getElementById(id);
          const v = parsed && typeof parsed[id] === "string" ? parsed[id] : "1";
          el.value = v;
        }

        const mul = parsed && typeof parsed.rateMultiplier === "number" ? parsed.rateMultiplier : 1;
        rateMultiplier = Math.max(1, Math.floor(mul));
        syncRateMultiplierUI();
      }

      function saveState(tab) {
        const state = {};
        for (const id of STATE_IDS) {
          const el = document.getElementById(id);
          state[id] = String(el.value);
        }
        state.rateMultiplier = rateMultiplier;
        try {
          localStorage.setItem(`${STORAGE_KEY}.${tab}`, JSON.stringify(state));
        } catch {
          // ignore
        }
      }

      function readSci(prefix) {
        const mEl = document.getElementById(prefix + "Mantissa");
        const eEl = document.getElementById(prefix + "Exponent");

        const m = Number(mEl.value);
        const e = parseBigIntStrict(eEl.value);

        if (!isFiniteNumber(m)) {
          return { ok: false, error: "Mantissa must be a valid number." };
        }
        if (m < 0) {
          return { ok: false, error: "Mantissa must be greater than or equal to 0." };
        }
        if (e === null) {
          return { ok: false, error: "Exponent must be an integer." };
        }
        if (e < 0) {
          return { ok: false, error: "Exponent must be greater than or equal to 0." };
        }

        return { ok: true, value: normalizeSci({ m, e }) };
      }

      function sanitizeInputs() {
        for (const id of STATE_IDS) {
          const el = document.getElementById(id);
          if (!el) continue;

          if (id.endsWith("Exponent")) {
            const cur = parseBigIntStrict(el.value);
            if (cur === null) continue;
            el.value = (cur < 0n ? 0n : cur).toString();
            continue;
          }

          const cur = Number(el.value);
          if (!isFiniteNumber(cur)) continue;
          if (cur < 0) el.value = "0";
        }
      }

      function compareAbs(a, b) {
        if (a.m === 0 && b.m === 0) return 0;
        if (a.m === 0) return -1;
        if (b.m === 0) return 1;

        if (a.e > b.e) return 1;
        if (a.e < b.e) return -1;

        const am = Math.abs(a.m);
        const bm = Math.abs(b.m);
        if (am > bm) return 1;
        if (am < bm) return -1;
        return 0;
      }

      function addSci(a, b) {
        a = normalizeSci(a);
        b = normalizeSci(b);

        if (a.m === 0) return b;
        if (b.m === 0) return a;

        if (a.e === b.e) {
          return normalizeSci({ m: a.m + b.m, e: a.e });
        }

        let hi = a;
        let lo = b;
        if (hi.e < lo.e) {
          hi = b;
          lo = a;
        }

        const diff = hi.e - lo.e;
        if (diff > MAX_ALIGN_DIGITS) {
          return hi;
        }

        const scale = pow10(Number(-diff));
        return normalizeSci({ m: hi.m + lo.m * scale, e: hi.e });
      }

      function subSci(a, b) {
        return addSci(a, { m: -b.m, e: b.e });
      }

      function divSci(a, b) {
        a = normalizeSci(a);
        b = normalizeSci(b);

        if (b.m === 0) {
          return { ok: false, error: "Rate must not be zero." };
        }

        return { ok: true, value: normalizeSci({ m: a.m / b.m, e: a.e - b.e }) };
      }

      function sciToString(s, significantDigits = 8) {
        s = normalizeSci(s);
        if (s.m === 0) return "0 seconds";

        const mStr = Number(s.m).toPrecision(significantDigits);
        const eStr = s.e.toString();
        return `${mStr} × 10^${eStr} seconds`;
      }

      function sciToNumberSecondsIfReasonable(s) {
        s = normalizeSci(s);
        if (s.m === 0) return 0;

        if (s.e > 18n || s.e < -6n) return null;

        const n = s.m * pow10(Number(s.e));
        if (!isFiniteNumber(n)) return null;
        return n;
      }

      function mulSci(a, b) {
        a = normalizeSci(a);
        b = normalizeSci(b);
        if (a.m === 0 || b.m === 0) return { m: 0, e: 0n };
        return normalizeSci({ m: a.m * b.m, e: a.e + b.e });
      }

      function formatApproxLargeYears(secondsSci) {
        const secondsPerYear = { m: 3.1536, e: 7n };
        const yearsRes = divSci(secondsSci, secondsPerYear);
        if (!yearsRes.ok) return "—";

        const years = normalizeSci(yearsRes.value);
        if (years.m === 0) return "0 seconds";

        const suffixes = [
          "",
          "thousand",
          "million",
          "billion",
          "trillion",
          "quadrillion",
          "quintillion",
          "sextillion",
          "septillion",
          "octillion",
          "nonillion",
          "decillion",
        ];

        const e = years.e;
        const groupIndex = e >= 0n ? Number(e / 3n) : 0;
        const suffix = suffixes[Math.min(groupIndex, suffixes.length - 1)];
        const groupExp = BigInt(groupIndex) * 3n;
        const within = Number(e - groupExp);
        const scaled = years.m * pow10(within);

        const formatted = Number(scaled).toFixed(scaled >= 100 ? 0 : scaled >= 10 ? 1 : 2);
        const label = suffix ? `${formatted} ${suffix} years` : `${formatted} years`;
        return `≈ ${label}`;
      }

      function formatHumanSeconds(seconds) {
        if (!isFiniteNumber(seconds) || seconds < 0) return "—";

        const units = [
          { name: "year", s: 365 * 24 * 3600 },
          { name: "day", s: 24 * 3600 },
          { name: "hour", s: 3600 },
          { name: "minute", s: 60 },
          { name: "second", s: 1 },
        ];

        if (seconds === 0) return "0 seconds";

        let remaining = seconds;
        const parts = [];
        for (const u of units) {
          if (parts.length >= 3) break;
          const qty = Math.floor(remaining / u.s);
          if (qty <= 0) continue;
          remaining -= qty * u.s;
          parts.push(`${qty} ${u.name}${qty === 1 ? "" : "s"}`);
        }

        if (parts.length === 0) {
          return `${seconds.toFixed(3)} seconds`;
        }

        return parts.join(" ");
      }

      function setStatus(text, isError) {
        const el = document.getElementById("status");
        el.textContent = text;
        el.classList.toggle("error", Boolean(isError));
      }

      function compute() {
        const targetR = readSci("target");
        if (!targetR.ok) {
          setStatus(targetR.error, true);
          return { ok: false };
        }

        const rateR = readSci("rate");
        if (!rateR.ok) {
          setStatus(rateR.error, true);
          return { ok: false };
        }

        const rateMultiplier = getRateMultiplier();
        const rateEffective = mulSci(rateR.value, { m: rateMultiplier, e: 0n });

        if (rateEffective.m <= 0) {
          setStatus("Rate must be greater than 0.", true);
          return { ok: false };
        }

        const timeDiv = divSci(targetR.value, rateEffective);
        if (!timeDiv.ok) {
          setStatus(timeDiv.error, true);
          return { ok: false };
        }

        return { ok: true, value: timeDiv.value };
      }

      function render() {
        const tHuman = document.getElementById("timeHuman");

        const res = compute();
        if (!res.ok) {
          tHuman.textContent = "—";
          return;
        }

        setStatus("", false);
        const n = sciToNumberSecondsIfReasonable(res.value);
        if (n === null) {
          tHuman.textContent = formatApproxLargeYears(res.value);
          return;
        }

        tHuman.textContent = formatHumanSeconds(n);
      }

      function bumpValue(id, delta) {
        const el = document.getElementById(id);

        if (id.endsWith("Exponent")) {
          const cur = parseBigIntStrict(el.value) ?? 0n;
          const next = cur + BigInt(delta);
          el.value = (next < 0n ? 0n : next).toString();
          saveState(activeTab);
          render();
          return;
        }

        const cur = Number(el.value);
        const next = (isFiniteNumber(cur) ? cur : 0) + Number(delta);
        el.value = String(next < 0 ? 0 : next);
        saveState(activeTab);
        render();
      }

      document.addEventListener("click", (e) => {
        const t = e.target;
        if (!(t instanceof HTMLElement)) return;
        if (t.id === "rateMulUp") {
          rateMultiplier = Math.max(1, rateMultiplier * 2);
          syncRateMultiplierUI();
          saveState(activeTab);
          render();
          return;
        }
        if (t.id === "rateMulDown") {
          rateMultiplier = Math.max(1, Math.floor(rateMultiplier / 2));
          syncRateMultiplierUI();
          saveState(activeTab);
          render();
          return;
        }
        if (t.matches(".tab[data-tab]")) {
          const next = t.getAttribute("data-tab");
          if (!next) return;
          saveState(activeTab);
          setActiveTab(next);
          loadState(activeTab);
          saveState(activeTab);
          render();
          return;
        }
        if (!t.matches("button[data-step][data-delta]")) return;

        const step = t.getAttribute("data-step");
        const delta = t.getAttribute("data-delta");
        if (!step || !delta) return;

        bumpValue(step, delta);
      });

      for (const id of [
        "targetMantissa",
        "targetExponent",
        "rateMantissa",
        "rateExponent",
      ]) {
        const el = document.getElementById(id);
        const handler = () => {
          sanitizeInputs();
          saveState(activeTab);
          render();
        };
        el.addEventListener("input", handler);
        el.addEventListener("change", handler);
      }

      document.addEventListener("pointerdown", (e) => {
        const target = e.target;
        if (!(target instanceof HTMLInputElement)) return;
        if (target.type === "checkbox") return;
        if (target.disabled || target.readOnly) return;
        target.value = "";
      });

      setActiveTab(getStoredActiveTab());
      loadState(activeTab);
      saveState(activeTab);
      render();
    </script>
  </body>
</html>
